  Future<void> _submit() async {
    // Demo-only: immediately show success and return without backend call
    if (_demoWithdrawSuccess) {
      setState(() => _submitting = true);
      await Future<void>.delayed(const Duration(milliseconds: 300));
      if (!mounted) return;
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(content: Text('Withdrawal requested successfully')),
      );
      setState(() => _submitting = false);
      Navigator.pop(context, const {'status': 'success', 'mode': 'demo'});
      return;
    }
    if (_pendingPaise < 10000) {
      ScaffoldMessenger.of(context).showSnackBar(const SnackBar(content: Text('Minimum â‚¹100 required to withdraw')));
      return;
    }
    setState(() => _submitting = true);
    try {
      Map<String, dynamic> res;
      if (_method == 'UPI') {
        if (_upiId.text.trim().isEmpty || _upiName.text.trim().isEmpty || _upiMobile.text.trim().isEmpty) {
          throw Exception('Enter UPI ID, name and mobile');
        }
        res = await ApiLocator.referral.requestWithdrawUpi(
          upiId: _upiId.text.trim(),
          name: _upiName.text.trim(),
          mobile: _upiMobile.text.trim(),
          note: _note.text.trim().isEmpty ? null : _note.text.trim(),
        );
      } else {
        if (_accName.text.trim().isEmpty || _accNo.text.trim().isEmpty || _ifsc.text.trim().isEmpty || _bankName.text.trim().isEmpty || _contactName.text.trim().isEmpty || _contactMobile.text.trim().isEmpty) {
          throw Exception('Fill all bank details');
        }
        res = await ApiLocator.referral.requestWithdrawBank(
          bankAccountName: _accName.text.trim(),
          bankAccountNumber: _accNo.text.trim(),
          bankIfsc: _ifsc.text.trim(),
          bankName: _bankName.text.trim(),
          contactName: _contactName.text.trim(),
          contactMobile: _contactMobile.text.trim(),
          note: _note.text.trim().isEmpty ? null : _note.text.trim(),
        );
      }
      if (!mounted) return;
      ScaffoldMessenger.of(context).showSnackBar(const SnackBar(content: Text('Withdrawal requested')));
      Navigator.pop(context, res);
    } catch (e) {
      if (!mounted) return;
      final msg = e.toString().replaceFirst('Exception: ', '');
      ScaffoldMessenger.of(context).showSnackBar(SnackBar(content: Text(msg)));
    } finally {
      if (mounted) setState(() => _submitting = false);
    }
  }
